<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>how to run your first job on paramanata? | LINGO LABS.</title> <meta name="author" content="LINGO LABS."> <meta name="description" content="a beginner's guide"> <meta name="keywords" content="NLProc, NLP, AI, ML"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/lingo_iitgn.png?584348092b369ade47c92b9e33340861"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="stylesheet" href="/assets/css/custom.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://lingo-iitgn.github.io/blog/2023/paramananta/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">LINGO </span>LABS.</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">research</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/datasets/">datasets</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/compute/">compute</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">activities</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/reading/">reading group</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/gallery/">gallery</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">how to run your first job on paramanata?</h1> <p class="post-meta">October 20, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/server"> <i class="fas fa-hashtag fa-sm"></i> server</a>     ·   <a href="/blog/category/academics"> <i class="fas fa-tag fa-sm"></i> academics</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="instructions">Instructions</h2> <p>You will have to run the below command:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbatch fname.sh
</code></pre></div></div> <p>and the fname.sh looks like below</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

#SBATCH --job-name=mbert-gpu
#SBATCH --partition=gpu
#SBATCH --gres=gpu:2
#SBATCH --nodes=1                	# Run all processes on a s.node 	 
#SBATCH --ntasks=1               	# Run a single task           	 
#SBATCH --cpus-per-task=32        	# Number of CPU cores per tasks
#SBATCH --time=03:00:00          	# Time limit hrs:min:sec
#SBATCH --output=../logs/mbert_%j.log 	# Standard output and error log

pwd; hostname; date

echo "fine-tuning mbert on $SLURM_CPUS_ON_NODE CPU cores"

python ../py/mbert_param.py

Date
</code></pre></div></div> <p><strong>#SBATCH –time=03:00:00</strong> ⇒ if this time exceeds, your job will terminate immediately, so please give more time in order to avoid termination. <em>Max-time limit on GPU partition is 2 days</em>, You can check the time limit of all partitions using command “<strong>sinfo</strong>”</p> <p>There is a limited amount of storage available per user, it’s ~50GB,it may even decrease further as the number of users increases.</p> <p>In the above .sh file, you can play with the parameters, if any parameter is not correct, then it will throw an error. You can always check the log file.</p> <p>This is enough to get started.</p> <p>FOR GPU: there are only two options available here [<strong>#SBATCH –gres=gpu:2</strong>] (it will be only 1 or 2); #GPUs per node (Max. 2). For a GPU node, it has two GPU cards, each of 16GB.</p> <p>For submitting the job: <code class="language-plaintext highlighter-rouge">sbatch fname.sh</code></p> <p>For checking job queue: <code class="language-plaintext highlighter-rouge">squeue</code></p> <p>For terminating the job: <code class="language-plaintext highlighter-rouge">scancel job_id [you can get job id from squeue]</code></p> <p>To run a job on a specific node: <code class="language-plaintext highlighter-rouge">#SBATCH --nodelist=gpu0xx</code></p> <p>Show specific job details: <code class="language-plaintext highlighter-rouge">scontrol show job job_id</code></p> <p>Using the “<strong>sinfo</strong>” command, you can check the partition on which you want to run.</p> <p>As quoted by admin:</p> <blockquote> <p>As per policy at a given instance maximum 6 jobs can be in running state at a time under “GPU” partition within the same group. Rest will be in idle state.</p> </blockquote> <blockquote> <p>One group: IITGn, another group: non-IITGn</p> </blockquote> <p><img src="/assets/img/blogs/param.png" alt="squeue" title="squeue command display"></p> <p>After submitting your job, it can be seen in the job queue, so for user “suraj.k” who is running his job on “gpu002”, he can check his gpu usage after logging into the gpu node; like below.</p> <p><code class="language-plaintext highlighter-rouge">ssh gpu002</code></p> <p>After logging into the node, he can run the “nvidia-smi” command. So you can also try it out on your submitted job. You can’t try it out on other users’ jobs, you will get permission denied error.</p> <p>you don’t have to make any changes in the python file. Only changes are to be made in the .sh file and we should mention the path of the python file in the .sh file.</p> <h2 id="multi-gpu">Multi-GPU</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

#SBATCH --job-name=muril-mu-gpu
#SBATCH --partition=gpu
#SBATCH --gres=gpu:1               # GPUs per node (Max. 2)[2]
#SBATCH --nodes=2                  # Run all processes on a multi node       
#SBATCH --ntasks=2                 # Run multi task [4]
#SBATCH --tasks-per-node=1      	  # Tasks per node  [2]          
#SBATCH --cpus-per-task=32      	  # Number of CPU cores per task.
#SBATCH --time=23:00:00            # Time limit hrs:min:sec
#SBATCH --output=../logs/muril_%j.log  # Standard output and error log

pwd; hostname; date

echo "finetuning muril on $SLURM_CPUS_ON_NODE CPU cores"

python ../py/muril_param.py

date

</code></pre></div></div> <ol> <li>We have to specify the number of nodes that we want to use: <code class="language-plaintext highlighter-rouge">#SBATCH --nodes=X</code> </li> <li>We have to specify the amount of GPUs per node (with a limit of 2 GPUs per user): <code class="language-plaintext highlighter-rouge">#SBATCH --gres=gpu:Y</code> </li> <li>The total number of tasks is equal to the product between the number of nodes and the number of GPUs per node: <code class="language-plaintext highlighter-rouge">#SBATCH --ntasks=X·Y</code> </li> <li>We have to distribute the number of tasks per node: <code class="language-plaintext highlighter-rouge">#SBATCH --tasks-per-node=(X·Y)/X</code> </li> </ol> <h2 id="mpi4py">MPI4PY</h2> <p>If you have to use mpi4py package in your code, then you can put below commands in you .sh file</p> <p><code class="language-plaintext highlighter-rouge">#module load spack</code> <code class="language-plaintext highlighter-rouge">#source /home/apps/spack/share/spack/setup-env.sh</code> <code class="language-plaintext highlighter-rouge">#spack load py-mpi4py@3.1.2 /rhlwd3z</code></p> <p>Or you can individually execute these commands on your terminal one by one.</p> <h2 id="useful-commands">Useful Commands</h2> <p><code class="language-plaintext highlighter-rouge">module avail</code> <code class="language-plaintext highlighter-rouge">sacct -u “uname”</code></p> </div> </article> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 LINGO LABS.. Last updated: October 21, 2023. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>